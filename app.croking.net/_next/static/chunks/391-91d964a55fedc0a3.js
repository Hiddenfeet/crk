"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[391],{21815:function(n,e,t){t.r(e),t.d(e,{AddressZero:function(){return a.d},EtherSymbol:function(){return r},HashZero:function(){return o.R},MaxInt256:function(){return i.PS},MaxUint256:function(){return i.Bz},MinInt256:function(){return i.$B},NegativeOne:function(){return i.tL},One:function(){return i.fh},Two:function(){return i.Py},WeiPerEther:function(){return i.Ce},Zero:function(){return i._Y}});var a=t(9279),i=t(21046),o=t(57218);const r="\u039e"},10391:function(n,e,t){t.d(e,{j:function(){return w}});var a=t(75405),i=t(67294),o=t(57495),r=t(8102),s=t(3453),c=t(1581),d=t(21815),l=t(67827),u=t(83778);const v=["function nonce() view returns (uint256)","event ExecutionSuccess(bytes32 txHash, uint256 payment)"],m={SafeTx:[{type:"address",name:"to"},{type:"uint256",name:"value"},{type:"bytes",name:"data"},{type:"uint8",name:"operation"},{type:"uint256",name:"safeTxGas"},{type:"uint256",name:"baseGas"},{type:"uint256",name:"gasPrice"},{type:"address",name:"gasToken"},{type:"address",name:"refundReceiver"},{type:"uint256",name:"nonce"}]},f=async(n,e,t,a)=>{const i=((n,e,t)=>l.E.hash({verifyingContract:n.address,chainId:t},m,e))(e,a,t);return new Promise(((t,o)=>{n.catch((n=>{"Transaction was rejected"===(null===n||void 0===n?void 0:n.message)&&o(n)}));const r=async(n,o,s)=>{if(n===i){e.removeListener("ExecutionSuccess",r);const n=await s.getTransaction(),a=await s.getTransactionReceipt();t({transaction:n,receipt:a,rejected:!1})}else{const n=await e.nonce();if(Number(n)>Number(a.nonce)){e.removeListener("ExecutionSuccess",r);const n=await s.getTransaction(),a=await s.getTransactionReceipt();t({transaction:n,receipt:a,rejected:!0})}}};e.on("ExecutionSuccess",r)}))};var g=t(64146);function p(n,e){const[t,a]=(0,i.useState)({status:"None",transactionName:null===e||void 0===e?void 0:e.transactionName}),{addTransaction:l,updateTransaction:m}=(0,r.W)(),{addNotification:p}=(0,s.l)(),{library:h,account:N}=(0,o.K)(),w=((n,e)=>{const t=(0,i.useRef)(void 0);return(0,i.useEffect)((()=>()=>{var n;null===(n=t.current)||void 0===n||n.removeAllListeners()}),[]),{get:()=>{if(n&&e)return t.current&&t.current.removeAllListeners(),t.current=new g.Contract(n,v,e),t.current}}})(N,h),y=(0,i.useCallback)((()=>{a((({transactionName:n})=>({status:"None",transactionName:n})))}),[a]);return{promiseTransaction:(0,i.useCallback)((async(t,{safeTransaction:i}={},o)=>{var r,s,v,g,y,b,T,S,I,j,x,C,E,P,O,L,A,G,k,R,M;const D=async(t,{safeTransaction:i}={})=>{var o;if(!n||!h||!N)return;a({status:"CollectingSignaturePool",chainId:n,transactionName:null===e||void 0===e?void 0:e.transactionName});const r=w.get();if(!r)throw new Error("Couldn't create Gnosis Safe contract instance");const s=await(async(n,e)=>{var t,a,i;try{const o=await fetch(`https://safe-transaction.${null===(t=(0,u.xz)(n))||void 0===t?void 0:t.chainName}.gnosis.io/api/v1/safes/${e}/all-transactions?limit=1&executed=false&queued=true`);if(!o.ok)return null;const r=await o.json();return(null===(i=null===(a=null===r||void 0===r?void 0:r.results)||void 0===a?void 0:a[0])||void 0===i?void 0:i.nonce)||null}catch(o){return void console.error(o)}})(n,N),c={to:(v={to:null!==(o=null===i||void 0===i?void 0:i.to)&&void 0!==o?o:"",value:null===i||void 0===i?void 0:i.value,data:null===i||void 0===i?void 0:i.data,safeTxGas:null===i||void 0===i?void 0:i.safeTxGas,nonce:s?s+1:await r.nonce()}).to,value:v.value||0,data:v.data||"0x",operation:v.operation||0,safeTxGas:v.safeTxGas||0,baseGas:v.baseGas||0,gasPrice:v.gasPrice||0,gasToken:v.gasToken||d.AddressZero,refundReceiver:v.refundReceiver||d.AddressZero,nonce:v.nonce||0};var v;const{transaction:m,receipt:g,rejected:p}=await f(t,r,n,c);if(p){const t="On-chain rejection created";l({transaction:Object.assign(Object.assign({},m),{chainId:n}),receipt:g,submittedAt:Date.now(),transactionName:null===e||void 0===e?void 0:e.transactionName}),a({status:"Fail",transaction:m,receipt:g,errorMessage:t,chainId:n,transactionName:null===e||void 0===e?void 0:e.transactionName})}else l({transaction:Object.assign(Object.assign({},m),{chainId:n}),receipt:g,submittedAt:Date.now(),transactionName:null===e||void 0===e?void 0:e.transactionName}),a({receipt:g,transaction:m,status:"Success",chainId:n,transactionName:null===e||void 0===e?void 0:e.transactionName});return{transaction:m,receipt:g}};if(!n)return;let F;try{a({status:"PendingSignature",chainId:n,transactionName:null===e||void 0===e?void 0:e.transactionName}),(null===e||void 0===e?void 0:e.enablePendingSignatureNotification)&&p({notification:{type:"transactionPendingSignature",submittedAt:Date.now(),transactionName:null===e||void 0===e?void 0:e.transactionName,transactionRequest:o},chainId:n});if(!(await async function(n,e){return!n||!e||"0x"===await n.getCode(e)}(h,N))){const n=await D(t,{safeTransaction:i});return F=null===n||void 0===n?void 0:n.transaction,null===n||void 0===n?void 0:n.receipt}{F=await t;const i=await(async t=>{if(!n)return;a((({transactionName:n})=>({transactionName:n,transaction:t,status:"Mining"}))),l({transaction:Object.assign(Object.assign({},t),{chainId:n}),submittedAt:Date.now(),transactionName:null===e||void 0===e?void 0:e.transactionName});const i=await t.wait();return m({transaction:Object.assign(Object.assign({},t),{chainId:n}),receipt:i,transactionName:null===e||void 0===e?void 0:e.transactionName}),a({receipt:i,transaction:t,status:"Success",chainId:n,transactionName:null===e||void 0===e?void 0:e.transactionName}),{transaction:t,receipt:i}})(F);return F=null===i||void 0===i?void 0:i.transaction,null===i||void 0===i?void 0:i.receipt}}catch(Z){const t=parseInt(null!==(T=null!==(y=null!==(v=null===(s=null===(r=Z.error)||void 0===r?void 0:r.data)||void 0===s?void 0:s.code)&&void 0!==v?v:null===(g=Z.error)||void 0===g?void 0:g.code)&&void 0!==y?y:null===(b=Z.data)||void 0===b?void 0:b.code)&&void 0!==T?T:Z.code),i=isNaN(t)?void 0:t,o=null!==(x=null===(j=null===(I=null===(S=null===Z||void 0===Z?void 0:Z.error)||void 0===S?void 0:S.data)||void 0===I?void 0:I.originalError)||void 0===j?void 0:j.data)&&void 0!==x?x:null===(C=null===Z||void 0===Z?void 0:Z.error)||void 0===C?void 0:C.data,d=null!==(R=null!==(G=null!==(A=null!==(O=null===(P=null===(E=Z.error)||void 0===E?void 0:E.data)||void 0===P?void 0:P.message)&&void 0!==O?O:null===(L=Z.error)||void 0===L?void 0:L.message)&&void 0!==A?A:Z.reason)&&void 0!==G?G:null===(k=Z.data)||void 0===k?void 0:k.message)&&void 0!==R?R:Z.message;if(F){if((n=>(null===n||void 0===n?void 0:n.code)===c.ErrorCode.TRANSACTION_REPLACED&&(null===n||void 0===n?void 0:n.replacement)&&("repriced"===(null===n||void 0===n?void 0:n.reason)||!1===(null===n||void 0===n?void 0:n.cancelled)))(Z)){const e=0===Z.receipt.status?"Fail":"Success";p({notification:{type:"Fail"===e?"transactionFailed":"transactionSucceed",submittedAt:Date.now(),transaction:Z.replacement,receipt:Z.receipt,transactionName:null===(M=Z.replacement)||void 0===M?void 0:M.transactionName,originalTransaction:F},chainId:n}),a((t=>{var a;return Object.assign(Object.assign({},t),{status:e,transaction:Z.replacement,originalTransaction:F,receipt:Z.receipt,transactionName:null===(a=Z.replacement)||void 0===a?void 0:a.transactionName,errorMessage:d,errorCode:i,errorHash:o,chainId:n})}))}else a({status:"Fail",transaction:F,receipt:Z.receipt,errorMessage:d,errorCode:i,errorHash:o,chainId:n,transactionName:null===e||void 0===e?void 0:e.transactionName})}else a({status:"Exception",errorMessage:d,errorCode:i,errorHash:o,chainId:n,transactionName:null===e||void 0===e?void 0:e.transactionName});return}}),[n,p,null===e||void 0===e?void 0:e.transactionName,h,N]),state:t,resetState:y}}var h=t(10979),N=t(79911);function w(n,e,t){var r,s,c;const{library:d,chainId:l}=(0,o.K)(),u=t&&"chainId"in t&&(null===t||void 0===t?void 0:t.chainId)||l,{promiseTransaction:v,state:m,resetState:f}=p(u,t),[g,w]=(0,i.useState)(void 0),y=(0,a.Z)(),b=null!==(c=null!==(s=null!==(r=null===t||void 0===t?void 0:t.gasLimitBufferPercentage)&&void 0!==r?r:null===t||void 0===t?void 0:t.bufferGasLimitPercentage)&&void 0!==s?s:null===y||void 0===y?void 0:y.gasLimitBufferPercentage)&&void 0!==c?c:0,T=(0,h.Kz)(),S=u&&T[u];return{send:(0,i.useCallback)((async(...a)=>{var i;if(n){const o=n.interface.getFunction(e).inputs.length,r=a.length>o;if(a.length!==o&&a.length!==o+1)throw new Error(`Invalid number of arguments for function "${e}".`);const s=((n,e,t)=>{const a=e&&"privateKey"in e&&e.privateKey,i=e&&"mnemonicPhrase"in e&&e.mnemonicPhrase,o=e&&"json"in e&&e.json,r=e&&"password"in e&&e.password,s=a&&n&&new N.Wallet(a,n),c=i&&n&&N.Wallet.fromMnemonic(i).connect(n),d=o&&r&&n&&N.Wallet.fromEncryptedJsonSync(o,r).connect(n),l=e&&"signer"in e&&e.signer;return s||c||d||l||(t&&"getSigner"in t?t.getSigner():void 0)})(S,t,d),c=function(n,e,t){if(n.signer)return n;if(e&&"signer"in e)return n.connect(e.signer);if(t)return n.connect(t);throw new TypeError("No signer available in contract, options or library")}(n,t,s),l=r?a[a.length-1]:void 0,u="object"===typeof l&&Object.prototype.hasOwnProperty.call(l,"gasLimit")?l.gasLimit:null!==(i=await async function(n,e,t,a){try{const i=await n.estimateGas[e](...t);return null===i||void 0===i?void 0:i.mul(a+100).div(100)}catch(i){return void console.error(i)}}(c,e,a,b))&&void 0!==i?i:null,m=Object.assign({gasLimit:u},l),f=r?a.slice(0,a.length-1):a,g=await v(c[e](...f,m),{safeTransaction:{to:n.address,value:null===l||void 0===l?void 0:l.value,data:n.interface.encodeFunctionData(e,f),safeTxGas:null!==u&&void 0!==u?u:void 0}});if(null===g||void 0===g?void 0:g.logs){const e=g.logs.reduce(((e,t)=>{try{return t.address.toLowerCase()===n.address.toLowerCase()?[...e,n.interface.parseLog(t)]:e}catch(a){return e}}),[]);w(e)}return g}}),[n,e,t,S,d,b,v]),state:m,events:g,resetState:f}}}}]);